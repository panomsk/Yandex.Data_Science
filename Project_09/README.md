# Восстановление золота из руды
Подготовьте прототип модели машинного обучения для «Цифры». Компания разрабатывает решения для эффективной работы промышленных предприятий.

Модель должна предсказать коэффициент восстановления золота из золотосодержащей руды. Используйте данные с параметрами добычи и очистки. 

Модель поможет оптимизировать производство, чтобы не запускать предприятие с убыточными характеристиками.

Вам нужно:

1. Подготовить данные;
2. Провести исследовательский анализ данных;
3. Построить и обучить модель.

Чтобы выполнить проект, обращайтесь к библиотекам *pandas*, *matplotlib* и *sklearn.* Вам поможет их документация.

**Описание проекта**
Данные находятся в трёх файлах:
- *gold_recovery_train_new.csv* — обучающая выборка;  
- *gold_recovery_test_new.csv* — тестовая выборка;  
- *gold_recovery_full_new.csv* — исходные данные.  

Данные индексируются датой и временем получения информации (признак date). Соседние по времени параметры часто похожи.  
Некоторые параметры недоступны, потому что замеряются и/или рассчитываются значительно позже. Из-за этого в тестовой выборке отсутствуют некоторые признаки, которые могут быть в обучающей. Также в тестовом наборе нет целевых признаков.  
Исходный датасет содержит обучающую и тестовую выборки со всеми признаками.  
В вашем распоряжении сырые данные: их просто выгрузили из хранилища. Прежде чем приступить к построению модели, проверьте по нашей инструкции их на корректность.  

## Выводы
**При выполнении проекта:** 

**На этапе подготовки данных:**  
- Данные успешно загружены из файлов: 
  - *gold_recovery_train_new.csv* — обучающая выборка;  
  - *gold_recovery_test_new.csv* — тестовая выборка;  
  - *gold_recovery_full_new.csv* — исходные данные. 
- Дубликатов в данных нет
- При изучении данных выявлено, что в данных есть пропуски, на гистограммах видны выбросы, в тестовом датасете отсутствуют целевые признаки rougher.output.recovery и final.output.recovery. В обучающем датасете есть признаки, отсутствующие в тестовой выборке - соответственно данные признаки не могут быть использованы для обучения моделей. Данные требуют дальнейшей обработки.  
- Проверена формула вычисления эффективности обогащения. Значение МАЕ крайне мало, а значит формула корректна.  
- Проанализированы признаки обучающей выборки, отсутствующие в тестовой:  
  - в тестовой выборке отсутствуют параметры продукта (блок output) для каждой из стадий  
  - в тестовой выборке отсутствуют расчетные параметры (блок calculation) для стадии флотации  
  - в тестовой выборке отсутствуют целевые признаки rougher.output.recovery и final.output.recovery  
- При этом в тестовой выборке присутствуют:
  - параметры сырья (блок input) на этапе флотации  
  - параметры, характеризующие состояние этапа (блок state) для стадий флотации, первичной и вторичной очистки.  
-  Все абсолютно логично, на тестовой выборке у нас есть параметры процесса и характеристики сырья и мы должны определить эффективность обогащения продукта. Параметры, отсутствующие в тестовой выборке (но присутствующие в обучающей) мы знать не можем, пока не проведем полный цикл технологического процесса.
- Проведена предобработка данных. Недостающие целевые признаки 'rougher.output.recovery','final.output.recovery' в тестовый датасет добавлены из полного датасета 
- В датасете df_train удалены колонки, отсутствующие в df_test  
- Поскольку значения у нас упорядочены по дате, то для заполнения пропусков можно использован метод ffill  

**На этапе анализа данных:**  
- Проведено исследование изменения концентрации элементов на каждом этапе  
  - Концентрация золота растет от стадии к стадии - это самое главное.  
  - Концентрация серебра после роста на стадии флотации затем уменьшается.  
  - Концентрация свинца незначительно увеличивается от стадии к стадии.  
- Проведен анализ распределения размеров гранул на обучающей и тестовой выборках. Судя по гистограмме, распределение размера гранул в тестовой и обучающей выборках отличаются незначительно.  
- Проведено исследование суммарных концентраций на разных стадиях  
  - Наблюдается явная аномалия в районе нулевого значения. Нулевая суммарная концентрация веществ говорит скорее всего говорит о том, что были какие-то сбои в работе оборудования КИПиА. Значит, вполне возможно, что значения в остальных столбцах также будут некорректными. Поэтому, в данном случае лучше удалить такие строки как из обучающей, так и из тестовой выборки.  
  - Удалось удалить аномальные выбросы суммарных концентраций в районе 0 из df_test и df_train.  
  
**На этапе построения модели:** 
- Разработана функция для вычисления итогового sMAPE.  
- Обучены и проверены с помощью кросс-валидации 4 типа моделей машинного обучения.  
- Лучшие результаты на обучающей выборке показал метод CatBoostRegressor с параметрами по умолчанию.  
- На тестовой выборке итоговое sMAPE = 7.07%, что примерно на 0.3% лучше результатов, показанных константной медианной моделью.

**Таким образом, можно рекомендовать модель CatBoostRegressor для прогнозирования эффективности обогащения чернового и финального концентратов.**